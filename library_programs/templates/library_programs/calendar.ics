{% load tz %}BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//{{ site_name }}//NONSGML Event Calendar//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:{{ site_name }}

{% for event in all_events %}
BEGIN:VEVENT
UID:{{ event.id }}-{{ event.occur }}@{{ site_name|slugify }}
DTSTAMP:{{ now|utc|date:"Ymd\THis\Z" }}
{% if event.all_day %}
DTSTART;VALUE=DATE:{{ event.ics_start|date:"Ymd" }}
DTEND;VALUE=DATE:{{ event.ics_end|date:"Ymd" }}
{% else %}
DTSTART:{{ event.ics_start|utc|date:"Ymd\THis\Z" }}
DTEND:{{ event.ics_end|utc|date:"Ymd\THis\Z" }}
{% endif %}
SUMMARY:{{ event.title }}
DESCRIPTION:{{ event.description|striptags|safe }}
LOCATION:{% if event.location %}{{ event.location|striptags }}{% else %}{{ site_name }}{% endif %}
STATUS:CONFIRMED
SEQUENCE:0
END:VEVENT
{% endfor %}
END:VCALENDAR